<?php

namespace External\Model;

use External\Bean\TradeTokenBean;

class TradeTokenModel extends AbstractModel
{

    /**
     * @return TradeTokenBean
     */
    protected function getBean()
    {
        return parent::getBean(); // TODO: Change the autogenerated stub
    }

    /**
     * @param \library\Pgsql $model
     * @return \library\Pgsql
     */
    private function bindWhere($model)
    {
        $bean = $this->getBean();
        $bean->getCreateTime() && $model->between('create_time', $bean->getCreateTime());
        $bean->getOutTradeNo() && $model->like('out_trade_no', "%" . $bean->getOutTradeNo() . "%");
        $bean->getOrderNo() && $model->like('order_no', "%" . $bean->getOrderNo() . "%");
        $bean->getType() && $model->equalTo('type', $bean->getType());
        $bean->getisPay() && $model->equalTo('is_pay', $bean->getisPay());
        return $model;
    }

    /**
     * 获取
     * @return array
     */
    public function getList()
    {
        $bean = $this->getBean();
        $model = $this->db()->table('external_trade_token');
        $model = $this->bindWhere($model);
        $model->orderBy('create_time', 'desc');
        if ($bean->getPage()) {
            $result = $model->page($bean->getPageCurrent(), $bean->getPagePer());
        } else {
            $result = $model->multi();
        }
        return $this->success($result);
    }

    /**
     * 获取
     * @return array
     */
    public function getInfo()
    {
        $model = $this->db()->table('external_trade_token');
        $model = $this->bindWhere($model);
        $result = $model->one();
        return $this->success($result);
    }

}